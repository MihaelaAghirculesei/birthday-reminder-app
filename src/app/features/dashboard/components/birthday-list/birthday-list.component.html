<mat-card class="birthday-list-card">
  <mat-card-header class="birthday-list-header">
    <div class="header-title-section">
      <mat-card-title>ðŸ“… All Upcoming Birthdays</mat-card-title>
      @if (lastAction) {
        <button
          mat-raised-button
          color="accent"
          (click)="onUndo()"
          class="undo-button-enhanced"
          matTooltip="Undo last action"
          aria-label="Undo last action"
          >
          <mat-icon>undo</mat-icon>
          UNDO
        </button>
      }
    </div>
    <div class="header-search-section">
      <mat-form-field appearance="fill" class="dashboard-search-field">
        <mat-label>Search by name</mat-label>
        <input
          matInput
          placeholder="Type to search..."
          (input)="onSearchChange($event)"
          [value]="searchTerm"
          />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>
  </mat-card-header>
  <mat-card-content>
    @if (enrichedBirthdays.length > 0) {
      <div
        class="dashboard-birthday-list scrollable"
        >
        @for (birthday of enrichedBirthdays; track birthday.id) {
          <app-birthday-item
            [birthday]="birthday"
            [categories]="categories"
            [isEditing]="isEditing(birthday.id)"
            [editingData]="editService.currentEditingData"
            [daysUntilBirthday]="birthday.daysUntilBirthday"
            (edit)="editBirthday($event)"
            (deleted)="deleteBirthday($event)"
            (save)="saveBirthday($event)"
            (cancelled)="cancelEdit()"
            (quickEdit)="quickEditName($event)"
            (editInputChange)="onEditInputChange($event)"
            (photoSelected)="onPhotoSelected($event)"
            (photoRemoved)="onPhotoRemoved()"
            (rememberPhotoSelected)="onRememberPhotoSelected($event)"
            (rememberPhotoRemoved)="onRememberPhotoRemoved()"
          ></app-birthday-item>
        }
      </div>
    }

    @if (birthdays.length === 0 && searchTerm) {
      <div class="no-birthdays">
        <mat-icon class="no-data-icon">search_off</mat-icon>
        <p class="no-data-text">No birthdays found matching "{{ searchTerm }}"</p>
        <button mat-raised-button color="primary" (click)="onClearSearch()">
          <mat-icon>clear</mat-icon>
          Clear Search
        </button>
      </div>
    }

    @if (birthdays.length === 0 && !searchTerm && totalBirthdays === 0) {
      <div class="no-birthdays">
        <mat-icon class="no-data-icon">cake</mat-icon>
        <p class="no-data-text">No birthdays yet. Add your first one!</p>
      </div>
    }
  </mat-card-content>
</mat-card>

@if (totalBirthdays === 0) {
  <div class="test-data-section">
    <mat-card class="test-data-card">
      <mat-card-content>
        <div class="test-data-content">
          <mat-icon class="test-icon">science</mat-icon>
          <div class="test-info">
            <h3>Want to try the app?</h3>
            <p>Add 10 sample birthdays with photos to test all features</p>
          </div>
          <button
            mat-raised-button
            color="primary"
            (click)="onAddTestData()"
            [disabled]="isAddingTestData"
            class="add-test-btn"
            >
            <mat-icon>add_circle</mat-icon>
            {{ isAddingTestData ? 'Adding...' : 'Add Test Data' }}
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
}

@if (totalBirthdays > 0) {
  <div class="backup-section">
    <mat-card class="backup-card">
      <mat-card-content>
        <div class="backup-content">
          <mat-icon class="backup-icon">backup</mat-icon>
          <div class="backup-info">
            <h3>Backup & Restore</h3>
            <p>Export or import your birthday data</p>
          </div>
          <div class="backup-actions">
            <button mat-stroked-button color="primary" (click)="onExportJSON()" matTooltip="Export all birthdays to JSON file" aria-label="Export birthdays to JSON">
              <mat-icon>download</mat-icon>
              JSON
            </button>
            <button mat-stroked-button color="primary" (click)="onExportCSV()" matTooltip="Export all birthdays to CSV file" aria-label="Export birthdays to CSV">
              <mat-icon>download</mat-icon>
              CSV
            </button>
            <button mat-stroked-button color="accent" (click)="jsonInput.click()" matTooltip="Import birthdays from JSON file" aria-label="Import birthdays from JSON">
              <mat-icon>upload</mat-icon>
              Import JSON
            </button>
            <button mat-stroked-button color="accent" (click)="csvInput.click()" matTooltip="Import birthdays from CSV file" aria-label="Import birthdays from CSV">
              <mat-icon>upload</mat-icon>
              Import CSV
            </button>
            <button mat-stroked-button color="accent" (click)="vcardInput.click()" matTooltip="Import birthdays from vCard file" aria-label="Import birthdays from vCard">
              <mat-icon>upload</mat-icon>
              Import vCard
            </button>
            <input #jsonInput type="file" accept=".json" (change)="onImportBackup($event)" hidden aria-label="JSON file input" />
            <input #csvInput type="file" accept=".csv" (change)="onImportCSV($event)" hidden aria-label="CSV file input" />
            <input #vcardInput type="file" accept=".vcf" (change)="onImportVCard($event)" hidden aria-label="vCard file input" />
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
}

@if (totalBirthdays > 0) {
  <div class="clear-data-section">
    <mat-card class="clear-data-card">
      <mat-card-content>
        <div class="clear-data-content">
          <mat-icon class="clear-icon">delete_sweep</mat-icon>
          <div class="clear-info">
            <h3>Clear All Data</h3>
            <p>Remove all birthdays from the app</p>
          </div>
          <button
            mat-raised-button
            color="warn"
            (click)="onClearAllData()"
            [disabled]="isClearingData"
            class="clear-all-btn"
            >
            <mat-icon>delete_forever</mat-icon>
            {{ isClearingData ? 'Clearing...' : 'Clear All' }}
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
}
