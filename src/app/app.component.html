<div class="app-container">
  <div class="app-header">
    <div class="header-top">
      <h1 class="hero-title">
        <calendar-icon size="48" strokeWidth="2" cssClass="hero-icon"></calendar-icon>
        Birthday Memories
      </h1>
      <app-network-status></app-network-status>
    </div>
    <p class="hero-subtitle">Never forget the special moments that matter most. Keep track of all your loved ones' birthdays with style.</p>
  </div>

  <div class="content-container">
    <app-dashboard *ngIf="(birthdays$ | async)?.length"></app-dashboard>
    
    <div class="test-data-section" *ngIf="(birthdays$ | async)?.length === 0">
      <mat-card class="test-data-card">
        <mat-card-content>
          <div class="test-data-content">
            <mat-icon class="test-icon">groups</mat-icon>
            <div class="test-info">
              <h3>Want to explore the app?</h3>
              <p>Add some sample birthdays to discover all the dashboard features</p>
            </div>
            <button mat-raised-button color="primary" (click)="addTestData()" [disabled]="isAddingTestData" class="add-test-btn">
              <mat-icon *ngIf="!isAddingTestData">visibility</mat-icon>
              <mat-progress-spinner *ngIf="isAddingTestData" diameter="20" mode="indeterminate"></mat-progress-spinner>
              {{ isAddingTestData ? 'Loading...' : 'Show Demo' }}
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="content-sections">
      <mat-card class="add-birthday-card">
        <mat-card-header>
          <mat-card-title>âœ¨ Add New Birthday</mat-card-title>
        </mat-card-header>   
      <mat-card-content>
        <form [formGroup]="birthdayForm" (ngSubmit)="onSubmit()" class="birthday-form">
          <photo-upload 
            [currentPhoto]="selectedPhoto"
            (photoSelected)="onPhotoSelected($event)"
            (photoRemoved)="onPhotoRemoved()">
          </photo-upload>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Name</mat-label>
            <input matInput formControlName="name" placeholder="e.g. John Doe">
            <mat-icon matSuffix>person</mat-icon>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Birth Date</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="birthDate">
            <mat-hint>Click the icon to open calendar</mat-hint>
            <mat-error *ngIf="birthdayForm.get('birthDate')?.hasError('required')">
              Birth date is required
            </mat-error>
            <mat-error *ngIf="birthdayForm.get('birthDate')?.hasError('futureDate')">
              Birth date cannot be in the future
            </mat-error>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Notes (optional)</mat-label>
            <textarea matInput formControlName="notes" placeholder="e.g. Gift: cooking book" rows="2"></textarea>
            <mat-icon matSuffix>notes</mat-icon>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Reminder Days</mat-label>
            <input matInput type="number" formControlName="reminderDays" min="1" max="365">
            <mat-hint>How many days before do you want to be reminded?</mat-hint>
            <mat-icon matSuffix>notifications</mat-icon>
          </mat-form-field>
          <div class="form-actions">
            <button 
              mat-raised-button 
              color="primary" 
              type="submit" 
              [disabled]="birthdayForm.invalid"
              class="submit-button">
              <mat-icon>add</mat-icon>
              Add Birthday
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
      <mat-card class="birthdays-list-card">
        <mat-card-header>
          <mat-card-title>ðŸŽ‰ Your Birthday Collection</mat-card-title>
          <mat-card-subtitle>{{ (birthdays$ | async)?.length || 0 }} special memories saved</mat-card-subtitle>
        </mat-card-header>
      
      <mat-card-content>
        <div class="filters-section">
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Search by name</mat-label>
            <input matInput 
                   placeholder="Type to search..." 
                   (input)="onSearchChange($event)">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
          <mat-form-field appearance="outline" class="month-filter">
            <mat-label>Filter by month</mat-label>
            <mat-select [value]="selectedMonth$ | async" 
                       (selectionChange)="onMonthChange($event.value)">
              <mat-option [value]="null">All months</mat-option>
              <mat-option *ngFor="let month of months; let i = index" [value]="i">
                {{ month }}
              </mat-option>
            </mat-select>
            <calendar-icon size="20" strokeWidth="2" cssClass="primary-icon"></calendar-icon>
          </mat-form-field>
          <mat-form-field appearance="outline" class="sort-field">
            <mat-label>Sort by</mat-label>
            <mat-select [value]="sortOrder$ | async" 
                       (selectionChange)="onSortChange($event.value)">
              <mat-option *ngFor="let option of sortOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>sort</mat-icon>
          </mat-form-field>
          <button mat-stroked-button 
                  color="primary" 
                  (click)="clearFilters()"
                  class="clear-filters-btn"
                  matTooltip="Clear all filters">
            <mat-icon>clear</mat-icon>
            Clear
          </button>
        </div>
        <div class="active-filters" *ngIf="(searchTerm$ | async) || (selectedMonth$ | async) !== null">
          <span class="filters-label">Active filters:</span>
          <mat-chip-set>
            <mat-chip *ngIf="searchTerm$ | async as search" 
                     (removed)="onSearchChange({target: {value: ''}})">
              Search: "{{ search }}"
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
            <mat-chip *ngIf="(selectedMonth$ | async) !== null" 
                     (removed)="onMonthChange(null)">
              Month: {{ getMonthName(selectedMonth$ | async) }}
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
          </mat-chip-set>
        </div>
        <div class="results-info">
          <span *ngIf="filteredBirthdays$ | async as filtered">
            Showing {{ filtered.length }} of {{ (birthdays$ | async)?.length || 0 }} birthdays
          </span>
        </div>
        <div *ngIf="(filteredBirthdays$ | async)?.length === 0; else birthdaysList" class="no-birthdays">
          <mat-icon class="large-icon">
            {{ (birthdays$ | async)?.length === 0 ? 'cake' : 'search_off' }}
          </mat-icon>
          <p *ngIf="(birthdays$ | async)?.length === 0; else noResults">
            You haven't added any birthdays yet!
          </p>
          <ng-template #noResults>
            <p>No birthdays match your current filters.</p>
            <button mat-button color="primary" (click)="clearFilters()">
              Clear filters
            </button>
          </ng-template>
          <p *ngIf="(birthdays$ | async)?.length === 0">Use the form above to add your first one.</p>
        </div>

        <ng-template #birthdaysList>
          <div class="birthday-list-container">
            <div *ngFor="let birthday of filteredBirthdays$ | async; let last = last" class="birthday-item">
              <div class="contact-avatar">
                <img *ngIf="birthday.photo" 
                     [src]="birthday.photo" 
                     [alt]="birthday.name"
                     class="contact-photo-small">
                <mat-icon *ngIf="!birthday.photo" color="primary" class="default-avatar">face</mat-icon>
              </div>
              
              <div class="birthday-content">
                <div class="birthday-info">
                  <div class="name">{{ birthday.name }}</div>
                  <div class="age">{{ calculateAge(birthday.birthDate) }} years old</div>
                </div>
                
                <div class="birthday-details">
                  <span class="birth-date">
                    <calendar-icon size="16" strokeWidth="2" cssClass="small-icon"></calendar-icon>
                    {{ birthday.birthDate | date:'MM/dd/yyyy' }}
                  </span>
                  <span class="next-birthday" [class.today]="getNextBirthdayText(birthday.birthDate) === 'Today!'" 
                        [class.tomorrow]="getNextBirthdayText(birthday.birthDate) === 'Tomorrow!'">
                    {{ getNextBirthdayText(birthday.birthDate) }}
                  </span>
                </div>
                
                <div *ngIf="birthday.notes" class="notes">
                  <mat-icon class="small-icon">notes</mat-icon>
                  {{ birthday.notes }}
                </div>
              </div>

              <div class="birthday-actions">
                <zodiac-icon [zodiacSign]="birthday.zodiacSign" *ngIf="birthday.zodiacSign"></zodiac-icon>
                <button 
                  mat-icon-button 
                  color="warn" 
                  (click)="deleteBirthday(birthday.id)"
                  matTooltip="Delete birthday"
                  class="delete-button">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </ng-template>
      </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>